<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🐍 Python 智能程式診斷平台</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
  <!-- Monaco Editor -->
  <script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>
  <!-- 題目管理器 -->
  <script src="questions-manager.js"></script>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-blue-50 to-purple-50 min-h-screen">

  <!-- 頂部導覽列 -->
  <header class="bg-white/90 backdrop-blur border-b border-gray-200 shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">
      <h1 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center gap-2">
        <span>🐍</span> <span>Python 智能程式診斷平台</span>
      </h1>
      <div class="flex items-center gap-3">
        <span id="backendStatus" class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700 border">檢查中</span>
        <span id="modelBadge" class="text-xs text-green-600 bg-green-50 border border-green-200 px-2 py-1 rounded-full cursor-pointer" title="點擊切換 API 模式">本地模式</span>
        <button id="apiModeToggleBtn" class="text-xs bg-gray-600 hover:bg-gray-700 text-white px-3 py-1.5 rounded-lg transition-colors duration-200" title="切換 API 模式">
          🔄 切換
        </button>
      </div>
    </div>
  </header>

  <!-- 主體內容 -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- 題目區塊 - 動態載入 -->
    <div id="questionContainer">
      <!-- 題目將由 questions-manager.js 動態生成 -->
      <div class="text-center py-8">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
        <p class="mt-4 text-gray-600">正在載入題目...</p>
      </div>
    </div>

    <!-- 程式碼編輯器 - 獨立佔滿一行 -->
    <section class="bg-white rounded-2xl p-4 sm:p-5 border border-gray-200 shadow-lg card-hover mb-6">
      <div class="flex items-center justify-between mb-4">
        <h4 class="font-semibold text-gray-800">🧑‍💻 程式碼編輯器</h4>
        <div class="text-xs text-gray-500">Ctrl + Enter 快速執行</div>
      </div>

      <div id="codeEditor" class="w-full h-56 sm:h-64 rounded-xl border border-gray-300 focus-within:ring-2 focus-within:ring-indigo-500 focus-within:border-indigo-500 overflow-hidden"></div>

      <div class="flex flex-wrap items-center gap-3 mt-4">
        <button id="runBtn" class="flex items-center gap-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-xl shadow transition-colors duration-200">
          ▶️ 執行程式
        </button>
        <button id="aiCheckBtn" class="flex items-center gap-2 bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded-xl shadow transition-colors duration-200">
          🤖 AI檢查
        </button>
        <button id="saveBtn" class="flex items-center gap-2 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-xl shadow transition-colors duration-200">
          💾 儲存程式碼
        </button>
        <button id="reconnectBtn" class="flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-xl shadow transition-colors duration-200 text-sm">
          🔄 重新連接
        </button>
        <span id="saveHint" class="text-xs text-gray-500">未儲存</span>
      </div>
    </section>

    <!-- 執行結果與 AI 分析並排 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- 執行結果 -->
      <section class="bg-white rounded-2xl p-4 sm:p-5 border border-gray-200 shadow-lg card-hover">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-semibold text-gray-800">🖥️ 執行結果</h4>
          <span id="runStatus" class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700 border">等待中</span>
        </div>
        <div class="terminal text-green-200 rounded-xl p-4 h-56 sm:h-64 overflow-auto scrollbar-thin border border-slate-700/40" id="outputBox">
          等待程式執行...
        </div>
      </section>

      <!-- AI 智能分析 -->
      <section class="bg-white rounded-2xl p-4 sm:p-5 border border-gray-200 shadow-lg card-hover">
        <div class="flex items-center justify-between mb-4">
          <h4 class="font-semibold text-gray-800">🤖 AI 智能分析與建議</h4>
          <div class="flex items-center gap-2">
            <span id="aiStatus" class="text-xs px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200">就緒</span>
            <button id="manualAnalyzeBtn" class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-lg transition-colors duration-200">手動分析</button>
          </div>
        </div>
        <div id="aiAnalysisBox" class="bg-gradient-to-br from-slate-50 to-white rounded-xl border border-gray-200 p-4">
          <div class="text-sm text-gray-700 leading-6">
            請先執行或使用 AI 檢查，這裡將顯示分析、錯誤定位與改進建議。
          </div>
          <ul id="aiSuggestionList" class="mt-3 text-sm text-gray-700 list-disc pl-5 space-y-1"></ul>
        </div>
      </section>
    </div>

    <!-- 學習進度概覽 -->
    <section class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl mt-8">
      <div class="px-4 sm:px-6 py-8 sm:py-10 text-white">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
          <div>
            <h2 class="text-2xl sm:text-3xl font-bold flex items-center gap-3 text-shadow">📊 學習進度</h2>
            <div id="studentNameDisplay" class="text-sm mt-2 opacity-90 flex items-center gap-2">
              <span>👤 學生：</span><span id="studentNameText" class="font-semibold">載入中...</span>
            </div>
          </div>
          <div class="text-sm bg-white/20 px-3 py-1.5 rounded-full border border-white/30">
            ⏱️ 總學習時間：<span id="totalTimeText" class="font-semibold">00:00</span>
          </div>
        </div>

        <div class="bg-white/15 rounded-2xl p-4 sm:p-6 backdrop-blur border border-white/20 shadow-lg mb-6">
          <div class="flex items-center justify-between mb-2">
            <div class="text-sm sm:text-base">完成度</div>
            <div class="text-sm"><span id="progressCount" class="font-semibold">0</span>/<span id="totalQuestions">10</span> 題目完成</div>
          </div>
          <div class="w-full h-3 bg-white/25 rounded-full overflow-hidden">
            <div id="progressBar" class="h-3 bg-white rounded-full transition-all duration-300" style="width:0%"></div>
          </div>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">總學習時間</div>
            <div id="totalTimeTextCard" class="text-2xl font-bold mt-1">00:00</div>
          </div>
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">程式修改次數</div>
            <div id="codeModCount" class="text-2xl font-bold mt-1">0</div>
          </div>
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">程式執行次數</div>
            <div id="runCount" class="text-2xl font-bold mt-1">0</div>
          </div>
          <div class="card-hover bg-white/30 rounded-2xl p-4 border border-white/40 shadow">
            <div class="text-white/90 text-sm">平均分數</div>
            <div id="avgScore" class="text-2xl font-bold mt-1">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- 學習活動統計面板（三欄） -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
      <!-- 1. 學習行為追蹤 -->
      <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">📈 學習行為追蹤</h4>

        <!-- 指標 -->
        <div class="space-y-4">
          <!-- 滑鼠移動次數 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">滑鼠移動次數</span>
              <span id="mouseMoveCount" class="text-indigo-700 font-semibold">0</span>
            </div>
            <div class="w-full h-2 bg-indigo-100 rounded-full overflow-hidden mt-1">
              <div id="mouseMoveBar" class="h-2 bg-indigo-500 rounded-full transition-all duration-300" style="width:0%"></div>
            </div>
            <div class="text-xs text-gray-500 mt-1">活躍度：<span id="mouseMoveActive">0%</span></div>
          </div>

          <!-- 點擊次數 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">點擊次數</span>
              <span id="clickCount" class="text-green-700 font-semibold">0</span>
            </div>
            <div class="w-full h-2 bg-green-100 rounded-full overflow-hidden mt-1">
              <div id="clickBar" class="h-2 bg-green-500 rounded-full transition-all duration-300" style="width:0%"></div>
            </div>
            <div class="text-xs text-gray-500 mt-1">每分鐘：約 <span id="clickPerMin">0</span> 次</div>
          </div>

          <!-- 鍵盤輸入次數 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">鍵盤輸入次數</span>
              <span id="keyPressCount" class="text-blue-700 font-semibold">0</span>
            </div>
            <div class="w-full h-2 bg-blue-100 rounded-full overflow-hidden mt-1">
              <div id="keyPressBar" class="h-2 bg-blue-500 rounded-full transition-all duration-300" style="width:0%"></div>
            </div>
            <div class="text-xs text-gray-500 mt-1">每分鐘：約 <span id="keyPerMin">0</span> 次</div>
          </div>

          <!-- 專注時間 -->
          <div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-700">專注時間</span>
              <span id="focusTimeText" class="text-purple-700 font-semibold">00:00</span>
            </div>
            <div class="w-full h-2 bg-purple-100 rounded-full overflow-hidden mt-1">
              <div id="focusBar" class="h-2 bg-purple-500 rounded-full transition-all duration-300" style="width:0%"></div>
            </div>
            <div class="text-xs text-gray-500 mt-1">當前連續專注：<span id="focusStreakText">0s</span></div>
          </div>
        </div>

        <!-- 底部基本統計 -->
        <div class="grid grid-cols-2 gap-3 mt-5">
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">成功執行</div>
            <div id="successfulRuns" class="text-lg font-bold text-gray-800">0</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">錯誤次數</div>
            <div id="errorCount" class="text-lg font-bold text-gray-800">0</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">程式修改</div>
            <div id="codeModBottom" class="text-lg font-bold text-gray-800">0</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-3 border">
            <div class="text-xs text-gray-500">累計分數</div>
            <div id="totalScoreCount" class="text-lg font-bold text-gray-800">0</div>
          </div>
        </div>
      </div>

      <!-- 2. AI 評分系統 -->
      <div class="bg-white rounded-2xl p-6 border border-gray-200 shadow-lg card-hover">
        <h4 class="font-semibold text-gray-800 mb-5 flex items-center gap-2">🏆 AI 評分系統</h4>
        
        <!-- 總分圓環 -->
        <div class="flex justify-center mb-6">
          <div class="relative">
            <svg height="180" width="180">
              <circle cx="90" cy="90" r="75" stroke="#E5E7EB" stroke-width="14" fill="none"/>
              <circle id="scoreRing" class="progress-ring__circle" cx="90" cy="90" r="75" stroke="#6366F1" stroke-linecap="round" stroke-width="14" fill="none" stroke-dasharray="471" stroke-dashoffset="471"/>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <div id="mainScore" class="text-5xl font-extrabold text-gray-800">-</div>
                <div class="text-sm text-gray-500 mt-1">總分</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 四個評分項目 -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-4 border border-indigo-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-indigo-700 font-semibold flex items-center gap-2">
                <span class="text-xl">⏱️</span>
                <span>時間複雜度</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreTimeComplexity" class="text-3xl font-bold text-indigo-800">-</div>
              <div class="text-lg text-indigo-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-indigo-600 mt-1">執行效率評估</div>
          </div>
          
          <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-purple-700 font-semibold flex items-center gap-2">
                <span class="text-xl">💾</span>
                <span>空間複雜度</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreSpaceComplexity" class="text-3xl font-bold text-purple-800">-</div>
              <div class="text-lg text-purple-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-purple-600 mt-1">記憶體使用評估</div>
          </div>
          
          <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-green-700 font-semibold flex items-center gap-2">
                <span class="text-xl">📖</span>
                <span>程式易讀性</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreReadability" class="text-3xl font-bold text-green-800">-</div>
              <div class="text-lg text-green-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-green-600 mt-1">代碼品質評估</div>
          </div>
          
          <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200 shadow-sm hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-blue-700 font-semibold flex items-center gap-2">
                <span class="text-xl">🛡️</span>
                <span>程式穩定性</span>
              </div>
            </div>
            <div class="flex items-baseline gap-1">
              <div id="subScoreStability" class="text-3xl font-bold text-blue-800">-</div>
              <div class="text-lg text-blue-600 font-semibold">/10</div>
            </div>
            <div class="text-xs text-blue-600 mt-1">錯誤處理評估</div>
          </div>
        </div>
      </div>

      <!-- 3. 效率統計 -->
      <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
        <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">⚡ 效率統計</h4>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">成功執行率</div>
            <div id="successRate" class="text-2xl font-bold text-gray-800">0%</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">平均編程時間</div>
            <div id="avgCodingTime" class="text-2xl font-bold text-gray-800">00:00</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">使用時長</div>
            <div id="sessionDuration" class="text-2xl font-bold text-gray-800">00:00</div>
          </div>
          <div class="bg-slate-50 rounded-xl p-4 border">
            <div class="text-xs text-gray-500">錯誤修正次數</div>
            <div id="fixCount" class="text-2xl font-bold text-gray-800">0</div>
          </div>
        </div>
      </div>
    </section>

    <!-- AI 學習弱點分析（頁面底部） -->
    <section class="mt-10">
      <!-- 標題 -->
      <div class="flex items-center justify-between mb-4">
        <h4 class="font-semibold text-gray-800 flex items-center gap-2">🧠 AI 學習弱點分析</h4>
        <span class="text-xs px-3 py-1 rounded-full bg-purple-100 text-purple-700 border border-purple-200">智能分析</span>
      </div>

      <!-- 兩欄佈局 -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- 左：弱點識別 -->
        <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
          <div class="font-semibold text-gray-800 mb-2 flex items-center gap-2">🔍 識別到的弱點領域</div>
          <div class="space-y-3">
            <div class="rounded-xl p-4 border bg-red-50 border-red-200">
              <div class="flex items-center justify-between">
                <span class="text-red-700 font-semibold">語法錯誤</span>
                <span id="weakSyntax" class="text-red-700 text-sm">70% 頻率</span>
              </div>
              <div class="w-full h-2 bg-red-100 rounded-full overflow-hidden mt-2">
                <div id="weakSyntaxBar" class="h-2 bg-red-500 rounded-full transition-all duration-300" style="width:70%"></div>
              </div>
            </div>
            <div class="rounded-xl p-4 border bg-yellow-50 border-yellow-200">
              <div class="flex items-center justify-between">
                <span class="text-yellow-700 font-semibold">編碼效率</span>
                <span id="weakSpeed" class="text-yellow-700 text-sm">45% 頻率</span>
              </div>
              <div class="w-full h-2 bg-yellow-100 rounded-full overflow-hidden mt-2">
                <div id="weakSpeedBar" class="h-2 bg-yellow-500 rounded-full transition-all duration-300" style="width:45%"></div>
              </div>
            </div>
            <div class="rounded-xl p-4 border bg-blue-50 border-blue-200">
              <div class="flex items-center justify-between">
                <span class="text-blue-700 font-semibold">變數命名</span>
                <span id="weakNaming" class="text-blue-700 text-sm">30% 頻率</span>
              </div>
              <div class="w-full h-2 bg-blue-100 rounded-full overflow-hidden mt-2">
                <div id="weakNamingBar" class="h-2 bg-blue-500 rounded-full transition-all duration-300" style="width:30%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- 右：改善建議 -->
        <div class="bg-white rounded-2xl p-5 border border-gray-200 shadow-lg card-hover">
          <div class="font-semibold text-gray-800 mb-2 flex items-center gap-2">💡 個人化學習建議</div>
          <div class="space-y-3">
            <!-- 立即行動 -->
            <div class="rounded-xl p-4 border bg-green-50 border-green-200">
              <div class="font-semibold text-green-800 mb-1">立即行動</div>
              <ul id="actionList" class="list-disc pl-5 text-sm text-green-900 space-y-1">
                <li>先完成輸出題，確保每行輸出一致</li>
                <li>輸入完畢後使用 AI 檢查取得分數</li>
                <li>每次修改後儲存一次，累積進度</li>
              </ul>
            </div>
            <!-- 推薦學習資源 -->
            <div class="rounded-xl p-4 border bg-purple-50 border-purple-200">
              <div class="font-semibold text-purple-800 mb-1">推薦學習資源</div>
              <ul class="list-disc pl-5 text-sm text-purple-900 space-y-1">
                <li><a href="https://docs.python.org/zh-tw/3/tutorial/" target="_blank" rel="noopener noreferrer" class="underline hover:text-purple-700">Python 官方教學</a></li>
                <li><a href="https://www.w3schools.com/python/" target="_blank" rel="noopener noreferrer" class="underline hover:text-purple-700">W3Schools Python</a></li>
                <li><a href="https://realpython.com/" target="_blank" rel="noopener noreferrer" class="underline hover:text-purple-700">Real Python</a></li>
              </ul>
            </div>
            <!-- 進度追蹤 -->
            <div class="rounded-xl p-4 border bg-slate-50 border-slate-200">
              <div class="font-semibold text-slate-800 mb-1">進度追蹤</div>
              <div class="text-sm text-slate-700">下次評估時間：<span id="nextAssessment">--:--</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 學習路徑建議 -->
      <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-5 border border-white/20 shadow-lg mt-6">
        <div class="text-white font-semibold mb-3 flex items-center gap-2">🗺️ 您的學習路徑建議</div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-white/15 border border-white/30 rounded-xl p-4 text-white">
            <div class="font-semibold mb-1">🌱 當前階段</div>
            <div class="text-sm">基礎語法：print、變數基礎、資料輸出</div>
          </div>
          <div class="bg-white/15 border border-white/30 rounded-xl p-4 text-white">
            <div class="font-semibold mb-1">🌿 下一階段</div>
            <div class="text-sm">變數與資料類型：int、str、list、dict</div>
          </div>
          <div class="bg-white/15 border border-white/30 rounded-xl p-4 text-white">
            <div class="font-semibold mb-1">🌳 進階目標</div>
            <div class="text-sm">流程控制：if、for、while 與函式拆分</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-xs text-gray-500">
    本平台為前端示範：Python 程式執行為模擬解析，非真實執行環境。
  </footer>

  <script src="script.js"></script></body>
</html>
